<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel | Menzah_fits Stock Management</title>
    <link rel="icon" type="image/svg+xml" href="/public/favicon.svg">
    <link rel="apple-touch-icon" href="/public/favicon.svg">
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;500;600;700&family=Roboto:wght@300;400;500;700&family=Roboto+Mono:wght@400;500&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <style>
        /* Material Design 3 + Nude Color Palette (matching front-end theme) */
        :root {
            /* Nude Color Palette - Matching front-end */
            --color-dusk-nude: #D4A59A;
            --color-dusk-nude-light: #E2C4BC;
            --color-dusk-nude-dark: #B08D7C;
            --color-dusty-rose: #C19A88;
            --color-twilight-nude: #A67C6D;
            --color-cream-nude: #F5E1D8;
            --color-soft-cream: #F0D9CC;
            --color-vanilla-cream: #E8C9B8;
            --color-natural-nude: #E2BFA5;
            --color-bare-skin: #D4AA8B;
            --color-earth-nude: #C69C82;
            --color-sienna-nude: #B38B6D;
            --color-deep-sienna: #8B6B52;
            --color-charcoal: #3D2E25;
            --color-accent-gold: #FFE4B5;
            
            /* Dev Superior gradient colors */
            --color-dev-purple: #7C3AED;
            --color-dev-purple-dark: #5B21B6;
            
            /* Primary palette - Dusk Nude inspired */
            --md-primary: #B08D7C;
            --md-on-primary: #ffffff;
            --md-primary-container: #F5E1D8;
            --md-on-primary-container: #3D2E25;
            
            /* Secondary palette - Earth Nude inspired */
            --md-secondary: #C69C82;
            --md-on-secondary: #ffffff;
            --md-secondary-container: #F0D9CC;
            --md-on-secondary-container: #3D2E25;
            
            /* Tertiary palette - Twilight Nude inspired */
            --md-tertiary: #A67C6D;
            --md-on-tertiary: #ffffff;
            --md-tertiary-container: #E8C9B8;
            --md-on-tertiary-container: #3D2E25;
            
            /* Surface colors - Cream tones */
            --md-surface: #FDF8F5;
            --md-surface-dim: #E8C9B8;
            --md-surface-bright: #FDF8F5;
            --md-surface-container-lowest: #ffffff;
            --md-surface-container-low: #FAF6F3;
            --md-surface-container: #F5E1D8;
            --md-surface-container-high: #F0D9CC;
            --md-surface-container-highest: #E8C9B8;
            --md-on-surface: #3D2E25;
            --md-on-surface-variant: #5C4A3D;
            
            /* Error */
            --md-error: #ba1a1a;
            --md-on-error: #ffffff;
            --md-error-container: #ffdad6;
            --md-on-error-container: #410002;
            
            /* Success */
            --md-success: #2E7D32;
            --md-success-container: #d4edda;
            
            /* Outline */
            --md-outline: #8B7A6D;
            --md-outline-variant: #D4C4B8;
            
            /* Shadows */
            --md-shadow: rgba(0, 0, 0, 0.15);
            
            /* Elevation */
            --md-elevation-1: 0 1px 2px 0 rgba(0, 0, 0, 0.3), 0 1px 3px 1px rgba(0, 0, 0, 0.15);
            --md-elevation-2: 0 1px 2px 0 rgba(0, 0, 0, 0.3), 0 2px 6px 2px rgba(0, 0, 0, 0.15);
            --md-elevation-3: 0 4px 8px 3px rgba(0, 0, 0, 0.15), 0 1px 3px rgba(0, 0, 0, 0.3);
            
            /* Border radius */
            --md-radius-sm: 8px;
            --md-radius-md: 12px;
            --md-radius-lg: 16px;
            --md-radius-xl: 28px;
            
            /* Transitions */
            --md-transition-fast: 0.15s ease;
            --md-transition-normal: 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: 'Roboto', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--md-surface);
            color: var(--md-on-surface);
            line-height: 1.5;
            min-height: 100vh;
        }
        
        /* Login Screen */
        .login-screen {
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            padding: 24px;
            background: 
                radial-gradient(ellipse 80% 60% at 15% 10%, rgba(212, 165, 154, 0.35) 0%, transparent 60%),
                radial-gradient(ellipse 70% 55% at 85% 8%, rgba(226, 191, 165, 0.3) 0%, transparent 55%),
                radial-gradient(ellipse 90% 50% at 5% 45%, rgba(240, 217, 204, 0.4) 0%, transparent 50%),
                linear-gradient(135deg, var(--color-cream-nude) 0%, var(--color-soft-cream) 50%, var(--color-vanilla-cream) 100%);
            position: relative;
            overflow: hidden;
        }
        
        .login-screen::before {
            content: '';
            position: absolute;
            inset: 0;
            background:
                repeating-linear-gradient(45deg, transparent 0px, transparent 18px, rgba(212, 165, 154, 0.04) 18px, rgba(212, 165, 154, 0.04) 20px),
                repeating-linear-gradient(-45deg, transparent 0px, transparent 18px, rgba(226, 191, 165, 0.04) 18px, rgba(226, 191, 165, 0.04) 20px);
            background-size: 40px 40px;
            pointer-events: none;
        }
        
        .login-card {
            background: var(--md-surface-container-lowest);
            border-radius: var(--md-radius-xl);
            padding: 40px;
            width: 100%;
            max-width: 400px;
            box-shadow: var(--md-elevation-3);
            position: relative;
            overflow: hidden;
        }
        
        .login-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--color-dusk-nude) 0%, var(--color-dusty-rose) 50%, var(--color-twilight-nude) 100%);
        }
        
        .login-logo {
            text-align: center;
            margin-bottom: 32px;
        }
        
        .login-logo-icon {
            width: 80px;
            height: 80px;
            margin: 0 auto 16px;
        }
        
        .login-brand {
            display: flex;
            align-items: baseline;
            justify-content: center;
        }
        
        .login-brand-main {
            font-size: 2rem;
            font-family: 'Playfair Display', serif;
            font-weight: 700;
            color: var(--md-primary);
        }
        
        .login-brand-accent {
            font-size: 2rem;
            font-family: 'Playfair Display', serif;
            font-weight: 500;
            color: var(--md-secondary);
        }
        
        .login-logo p {
            color: var(--md-on-surface-variant);
            margin-top: 8px;
            font-size: 0.875rem;
        }
        
        /* Palm F Icon - Matching frontend */
        .palm-f-icon {
            display: inline-block;
            vertical-align: baseline;
            color: currentColor;
        }
        
        .login-palm-f,
        .loader-palm-f,
        .nav-palm-f {
            width: 0.6em;
            height: 1em;
            margin-bottom: -0.1em;
        }
        
        /* Premium Page Loader - Matching frontend */
        .page-loader {
            position: fixed;
            inset: 0;
            z-index: 9999;
            display: flex;
            align-items: center;
            justify-content: center;
            background: 
                radial-gradient(
                    ellipse 80% 60% at 50% 30%,
                    rgba(245, 225, 216, 0.9) 0%,
                    transparent 60%
                ),
                linear-gradient(
                    160deg,
                    var(--color-cream-nude) 0%,
                    rgba(240, 217, 204, 0.95) 30%,
                    var(--color-cream-nude) 60%,
                    var(--color-soft-cream) 100%
                );
            transition: opacity 0.5s ease, visibility 0.5s ease;
        }
        
        .page-loader.hidden {
            opacity: 0;
            visibility: hidden;
            pointer-events: none;
        }
        
        .loader-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 1.5rem;
            text-align: center;
            padding: 2rem;
        }
        
        .loader-logo {
            width: 80px;
            height: 80px;
            animation: loader-pulse 2s ease-in-out infinite;
        }
        
        @keyframes loader-pulse {
            0%, 100% {
                transform: scale(1);
                opacity: 1;
            }
            50% {
                transform: scale(1.1);
                opacity: 0.8;
            }
        }
        
        /* Unified crochet logo SVG styling */
        .crochet-logo-svg {
            width: 100%;
            height: 100%;
            filter: drop-shadow(0 4px 12px rgba(176, 141, 124, 0.3));
        }
        
        .loader-brand {
            display: flex;
            align-items: baseline;
        }
        
        .loader-brand-main {
            font-size: 1.875rem;
            font-family: 'Playfair Display', serif;
            font-weight: 700;
            color: var(--md-primary);
        }
        
        .loader-brand-accent {
            font-size: 1.875rem;
            font-family: 'Playfair Display', serif;
            font-weight: 500;
            color: var(--md-secondary);
        }
        
        .loader-spinner {
            position: relative;
            width: 60px;
            height: 60px;
            margin: 1rem 0;
        }
        
        .spinner-circle {
            position: absolute;
            inset: 0;
            border: 3px solid transparent;
            border-top-color: var(--md-primary);
            border-radius: 50%;
            animation: spinner-rotate 1.2s linear infinite;
        }
        
        .spinner-circle-2 {
            inset: 8px;
            border-top-color: var(--md-secondary);
            animation-duration: 1.5s;
            animation-direction: reverse;
        }
        
        .spinner-circle-3 {
            inset: 16px;
            border-top-color: var(--md-tertiary);
            animation-duration: 1s;
        }
        
        @keyframes spinner-rotate {
            0% {
                transform: rotate(0deg);
            }
            100% {
                transform: rotate(360deg);
            }
        }
        
        .loader-text {
            font-size: 0.875rem;
            color: var(--color-charcoal);
            font-style: italic;
            opacity: 0.8;
            animation: text-fade 1.5s ease-in-out infinite;
        }
        
        @keyframes text-fade {
            0%, 100% {
                opacity: 0.5;
            }
            50% {
                opacity: 1;
            }
        }
        
        /* Material Input Fields */
        .md-field {
            position: relative;
            margin-bottom: 24px;
        }
        
        .md-field input,
        .md-field select,
        .md-field textarea {
            width: 100%;
            padding: 16px;
            border: 1px solid var(--md-outline-variant);
            border-radius: var(--md-radius-sm);
            font-size: 1rem;
            font-family: inherit;
            background: var(--md-surface-container-lowest);
            color: var(--md-on-surface);
            transition: all var(--md-transition-normal);
        }
        
        .md-field input:focus,
        .md-field select:focus,
        .md-field textarea:focus {
            outline: none;
            border-color: var(--md-primary);
            border-width: 2px;
        }
        
        .md-field label {
            position: absolute;
            top: 50%;
            left: 16px;
            transform: translateY(-50%);
            color: var(--md-on-surface-variant);
            font-size: 1rem;
            pointer-events: none;
            transition: all var(--md-transition-normal);
            background: var(--md-surface-container-lowest);
            padding: 0 4px;
        }
        
        .md-field input:focus + label,
        .md-field input:not(:placeholder-shown) + label {
            top: 0;
            font-size: 0.75rem;
            color: var(--md-primary);
        }
        
        /* Material Buttons */
        .md-btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 12px 24px;
            border: none;
            border-radius: var(--md-radius-xl);
            font-size: 0.875rem;
            font-weight: 500;
            font-family: inherit;
            letter-spacing: 0.1px;
            cursor: pointer;
            transition: all var(--md-transition-normal);
            text-decoration: none;
            position: relative;
            overflow: hidden;
        }
        
        .md-btn::before {
            content: '';
            position: absolute;
            inset: 0;
            background: currentColor;
            opacity: 0;
            transition: opacity var(--md-transition-fast);
        }
        
        .md-btn:hover::before {
            opacity: 0.08;
        }
        
        .md-btn:active::before {
            opacity: 0.12;
        }
        
        .md-btn .material-icons {
            font-size: 18px;
            transition: transform var(--md-transition-normal);
        }
        
        .md-btn:hover .material-icons {
            transform: scale(1.1);
        }
        
        .md-btn-primary {
            background: var(--md-primary);
            color: var(--md-on-primary);
            box-shadow: var(--md-elevation-1);
        }
        
        .md-btn-primary:hover {
            box-shadow: var(--md-elevation-2);
        }
        
        .md-btn-secondary {
            background: var(--md-secondary-container);
            color: var(--md-on-secondary-container);
        }
        
        .md-btn-text {
            background: transparent;
            color: var(--md-primary);
        }
        
        .md-btn-text:hover {
            background: rgba(176, 141, 124, 0.08);
        }
        
        .md-btn-icon {
            width: 40px;
            height: 40px;
            padding: 8px;
            border-radius: 50%;
        }
        
        .md-btn-icon:hover {
            background: var(--md-surface-container-high);
        }
        
        .md-btn-fab {
            position: fixed;
            bottom: 24px;
            right: 24px;
            width: 56px;
            height: 56px;
            border-radius: 16px;
            box-shadow: var(--md-elevation-3);
            z-index: 100;
        }
        
        /* App Layout */
        .app-layout {
            display: none;
            min-height: 100vh;
        }
        
        .app-layout.active {
            display: flex;
        }
        
        /* Navigation Rail */
        .nav-rail {
            width: 80px;
            background: linear-gradient(180deg, var(--md-surface-container) 0%, var(--md-surface-container-high) 100%);
            border-right: 1px solid var(--md-outline-variant);
            padding: 16px 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            position: fixed;
            height: 100vh;
            z-index: 50;
        }
        
        .nav-rail::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background:
                radial-gradient(circle at 50% 0%, rgba(212, 165, 154, 0.1) 0%, transparent 50%);
            pointer-events: none;
        }
        
        .nav-rail-logo {
            padding: 12px;
            margin-bottom: 24px;
            width: 52px;
            height: 52px;
            background: rgba(255, 255, 255, 0.6);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 8px rgba(176, 141, 124, 0.15);
            position: relative;
            z-index: 1;
        }
        
        .nav-crochet-svg {
            width: 100%;
            height: 100%;
            filter: drop-shadow(0 2px 8px rgba(176, 141, 124, 0.25));
        }
        
        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            padding: 12px 16px;
            margin: 4px 12px;
            border-radius: var(--md-radius-lg);
            color: var(--md-on-surface-variant);
            text-decoration: none;
            cursor: pointer;
            transition: all var(--md-transition-normal);
            border: none;
            background: transparent;
            width: calc(100% - 24px);
        }
        
        .nav-item:hover {
            background: rgba(0, 100, 148, 0.08);
        }
        
        .nav-item.active {
            background: var(--md-primary-container);
            color: var(--md-on-primary-container);
        }
        
        .nav-item span:not(.material-icons) {
            font-size: 0.625rem;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .nav-item .material-icons {
            font-size: 24px;
            overflow: hidden;
            width: 24px;
            height: 24px;
            transition: transform var(--md-transition-normal), color var(--md-transition-normal);
        }
        
        .nav-item:hover .material-icons {
            transform: scale(1.1);
        }
        
        .nav-item.active .material-icons {
            transform: scale(1.15);
            animation: nav-icon-pulse 0.3s ease-out;
        }
        
        @keyframes nav-icon-pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.25); }
            100% { transform: scale(1.15); }
        }
        
        /* Nav item icon colors */
        .nav-item[data-view="dashboard"] .material-icons {
            color: var(--md-tertiary);
        }
        .nav-item[data-view="products"] .material-icons {
            color: var(--color-dusty-rose);
        }
        .nav-item[data-view="users"] .material-icons {
            color: var(--color-earth-nude);
        }
        .nav-item[data-view="settings"] .material-icons {
            color: var(--color-sienna-nude);
        }
        .nav-item.active[data-view="dashboard"] .material-icons,
        .nav-item.active[data-view="products"] .material-icons,
        .nav-item.active[data-view="users"] .material-icons,
        .nav-item.active[data-view="settings"] .material-icons {
            color: var(--md-on-primary-container);
        }
        
        /* Main Content */
        .main-content {
            flex: 1;
            margin-left: 80px;
            padding: 24px;
        }
        
        /* Top App Bar */
        .top-bar {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 16px 24px;
            background: var(--md-surface);
            border-radius: var(--md-radius-lg);
            margin-bottom: 24px;
            box-shadow: var(--md-elevation-1);
            position: relative;
            overflow: hidden;
        }
        
        .top-bar::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--color-dusk-nude) 0%, var(--color-dusty-rose) 50%, var(--color-twilight-nude) 100%);
        }
        
        .top-bar h1 {
            font-size: 1.5rem;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .top-bar h1 .material-icons {
            font-size: 28px;
            color: var(--md-primary);
        }
        
        .top-bar-actions {
            display: flex;
            gap: 12px;
            align-items: center;
        }
        
        /* Stats Cards */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 16px;
            margin-bottom: 24px;
        }
        
        .stat-card {
            background: var(--md-surface-container-lowest);
            border-radius: var(--md-radius-lg);
            padding: 24px;
            box-shadow: var(--md-elevation-1);
            transition: all var(--md-transition-normal);
            position: relative;
            overflow: hidden;
        }
        
        .stat-card:hover {
            box-shadow: var(--md-elevation-2);
            transform: translateY(-2px);
        }
        
        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 80px;
            height: 80px;
            background: radial-gradient(circle at top right, rgba(176, 141, 124, 0.08) 0%, transparent 70%);
            border-radius: 0 var(--md-radius-lg) 0 80%;
        }
        
        .stat-card-icon {
            width: 56px;
            height: 56px;
            border-radius: var(--md-radius-md);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 16px;
            position: relative;
            transition: transform var(--md-transition-normal);
        }
        
        .stat-card:hover .stat-card-icon {
            transform: scale(1.05);
        }
        
        .stat-card-icon .material-icons {
            font-size: 28px;
        }
        
        .stat-card-icon.primary {
            background: var(--md-primary-container);
            color: var(--md-on-primary-container);
        }
        
        .stat-card-icon.secondary {
            background: var(--md-secondary-container);
            color: var(--md-on-secondary-container);
        }
        
        .stat-card-icon.tertiary {
            background: var(--md-tertiary-container);
            color: var(--md-on-tertiary-container);
        }
        
        .stat-card-icon.error {
            background: var(--md-error-container);
            color: var(--md-on-error-container);
        }
        
        .stat-card h3 {
            font-size: 0.875rem;
            font-weight: 500;
            color: var(--md-on-surface-variant);
            margin-bottom: 4px;
        }
        
        .stat-card .value {
            font-size: 2rem;
            font-weight: 500;
            color: var(--md-on-surface);
        }
        
        /* Product Table */
        .data-table {
            background: var(--md-surface-container-lowest);
            border-radius: var(--md-radius-lg);
            overflow: hidden;
            box-shadow: var(--md-elevation-1);
            transition: box-shadow var(--md-transition-normal);
        }
        
        .data-table:hover {
            box-shadow: var(--md-elevation-2);
        }
        
        .data-table-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 16px 24px;
            border-bottom: 1px solid var(--md-outline-variant);
            background: linear-gradient(135deg, var(--md-surface-container) 0%, var(--md-surface-container-low) 100%);
        }
        
        .data-table-header h2 {
            font-size: 1.125rem;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .data-table-header h2 .material-icons {
            font-size: 22px;
            color: var(--md-primary);
        }
        
        .data-table table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .data-table th,
        .data-table td {
            padding: 16px 24px;
            text-align: left;
        }
        
        .data-table th {
            font-size: 0.75rem;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: var(--md-on-surface-variant);
            background: var(--md-surface-container);
        }
        
        .data-table th .material-icons {
            font-size: 16px;
            vertical-align: middle;
            margin-right: 4px;
            opacity: 0.7;
        }
        
        .data-table tr {
            border-bottom: 1px solid var(--md-outline-variant);
            transition: background var(--md-transition-fast);
        }
        
        .data-table tr:hover {
            background: var(--md-surface-container);
        }
        
        .data-table tr:last-child {
            border-bottom: none;
        }
        
        .data-table td {
            vertical-align: middle;
        }
        
        .data-table td .material-icons {
            font-size: 18px;
        }
        
        /* Color Dots */
        .color-dots {
            display: flex;
            gap: 6px;
        }
        
        .color-dot {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            border: 2px solid var(--md-outline-variant);
            cursor: pointer;
            transition: transform var(--md-transition-fast);
        }
        
        .color-dot:hover {
            transform: scale(1.2);
        }
        
        /* Badge */
        .badge {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 4px 12px;
            border-radius: var(--md-radius-xl);
            font-size: 0.75rem;
            font-weight: 500;
        }
        
        .badge .material-icons {
            font-size: 14px;
        }
        
        .badge-bestseller {
            background: linear-gradient(135deg, rgba(255, 213, 79, 0.2) 0%, rgba(255, 193, 7, 0.15) 100%);
            color: #b88a00;
            border: 1px solid rgba(255, 193, 7, 0.3);
        }
        
        .badge-new {
            background: var(--md-secondary-container);
            color: var(--md-on-secondary-container);
        }
        
        .badge-limited {
            background: var(--md-tertiary-container);
            color: var(--md-on-tertiary-container);
        }
        
        .badge-featured {
            background: linear-gradient(135deg, var(--md-error-container) 0%, rgba(186, 26, 26, 0.08) 100%);
            color: var(--md-on-error-container);
        }
        
        .badge-low {
            background: var(--md-error-container);
            color: var(--md-on-error-container);
        }
        
        .badge-ok {
            background: #d4edda;
            color: #155724;
        }
        
        /* Modal */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(4px);
            -webkit-backdrop-filter: blur(4px);
            align-items: center;
            justify-content: center;
            z-index: 200;
            padding: 24px;
        }
        
        .modal-overlay.active {
            display: flex;
        }
        
        .modal {
            background: var(--md-surface-container-lowest);
            border-radius: var(--md-radius-xl);
            width: 100%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: var(--md-elevation-3);
            animation: modal-appear 0.3s ease-out;
        }
        
        @keyframes modal-appear {
            from {
                opacity: 0;
                transform: scale(0.95) translateY(10px);
            }
            to {
                opacity: 1;
                transform: scale(1) translateY(0);
            }
        }
        
        .modal-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 24px;
            border-bottom: 1px solid var(--md-outline-variant);
            background: linear-gradient(135deg, var(--md-primary-container) 0%, var(--md-surface-container) 100%);
        }
        
        .modal-header h2 {
            font-size: 1.5rem;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 12px;
            color: var(--md-on-primary-container);
        }
        
        .modal-header h2 .material-icons {
            font-size: 28px;
            color: var(--md-primary);
        }
        
        .modal-body {
            padding: 24px;
        }
        
        .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: 12px;
            padding: 16px 24px;
            border-top: 1px solid var(--md-outline-variant);
        }
        
        /* Form Grid */
        .form-row {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 16px;
        }
        
        @media (max-width: 600px) {
            .form-row {
                grid-template-columns: 1fr;
            }
        }
        
        /* Stock Editor */
        .stock-editor {
            margin-top: 24px;
        }
        
        .stock-editor h3 {
            font-size: 1rem;
            font-weight: 500;
            margin-bottom: 16px;
            color: var(--md-on-surface-variant);
        }
        
        .color-stock-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .color-stock-item {
            display: flex;
            align-items: flex-start;
            gap: 16px;
            padding: 12px;
            background: var(--md-surface-container);
            border-radius: var(--md-radius-md);
            flex-wrap: wrap;
        }
        
        .color-stock-item .color-preview {
            width: 40px;
            height: 40px;
            border-radius: var(--md-radius-sm);
            border: 2px solid var(--md-outline-variant);
        }
        
        .color-stock-item .color-info {
            flex: 1;
            min-width: 120px;
        }
        
        .color-stock-item .color-name {
            font-weight: 500;
            font-size: 0.875rem;
        }
        
        .color-stock-item .color-hex {
            font-size: 0.75rem;
            color: var(--md-on-surface-variant);
            font-family: 'Roboto Mono', monospace;
        }
        
        .color-stock-item input[type="number"] {
            width: 80px;
            padding: 8px 12px;
            border: 1px solid var(--md-outline-variant);
            border-radius: var(--md-radius-sm);
            font-size: 0.875rem;
            text-align: center;
        }
        
        .size-stock-grid {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            width: 100%;
            margin-top: 8px;
        }
        
        .size-stock-input {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
        }
        
        .size-stock-input label {
            font-size: 0.75rem;
            font-weight: 500;
            color: var(--md-on-surface-variant);
        }
        
        .size-stock-input input {
            width: 50px;
            padding: 6px 8px;
            border: 1px solid var(--md-outline-variant);
            border-radius: var(--md-radius-sm);
            font-size: 0.75rem;
            text-align: center;
        }
        
        /* Media Upload Styles */
        .media-upload-section {
            width: 100%;
            margin-top: 12px;
            padding: 12px;
            background: var(--md-surface-container-low);
            border-radius: var(--md-radius-md);
            border: 1px dashed var(--md-outline-variant);
        }
        
        .media-upload-header {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 12px;
            color: var(--md-on-surface-variant);
            font-size: 0.8125rem;
            font-weight: 500;
        }
        
        .media-upload-header .material-icons {
            font-size: 18px;
            color: var(--md-primary);
        }
        
        .media-upload-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            gap: 8px;
        }
        
        .media-upload-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 6px;
            padding: 16px 12px;
            background: var(--md-surface-container-lowest);
            border: 1px dashed var(--md-outline);
            border-radius: var(--md-radius-sm);
            cursor: pointer;
            transition: all var(--md-transition-normal);
            min-height: 80px;
        }
        
        .media-upload-btn:hover {
            background: var(--md-primary-container);
            border-color: var(--md-primary);
        }
        
        .media-upload-btn .material-icons {
            font-size: 24px;
            color: var(--md-primary);
        }
        
        .media-upload-btn span {
            font-size: 0.6875rem;
            color: var(--md-on-surface-variant);
            text-align: center;
        }
        
        .media-upload-btn input[type="file"] {
            display: none;
        }
        
        .media-preview-item {
            position: relative;
            aspect-ratio: 1;
            border-radius: var(--md-radius-sm);
            overflow: hidden;
            background: var(--md-surface-container);
        }
        
        .media-preview-item img,
        .media-preview-item video {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .media-preview-item .remove-media {
            position: absolute;
            top: 4px;
            right: 4px;
            width: 24px;
            height: 24px;
            background: var(--md-error);
            color: white;
            border: none;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity var(--md-transition-fast);
        }
        
        .media-preview-item:hover .remove-media {
            opacity: 1;
        }
        
        .media-preview-item .remove-media .material-icons {
            font-size: 16px;
        }
        
        .media-preview-item .media-type-badge {
            position: absolute;
            bottom: 4px;
            left: 4px;
            padding: 2px 6px;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            border-radius: 4px;
            font-size: 0.625rem;
            text-transform: uppercase;
        }
        
        /* Snackbar */
        .snackbar {
            position: fixed;
            bottom: 24px;
            left: 50%;
            transform: translateX(-50%) translateY(100px);
            background: linear-gradient(135deg, var(--color-charcoal) 0%, #4a3c32 100%);
            color: var(--md-surface);
            padding: 14px 24px;
            border-radius: var(--md-radius-md);
            box-shadow: var(--md-elevation-3);
            z-index: 300;
            transition: transform var(--md-transition-normal);
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .snackbar::before {
            content: 'info';
            font-family: 'Material Icons';
            font-size: 20px;
        }
        
        .snackbar.active {
            transform: translateX(-50%) translateY(0);
        }
        
        /* Crochet Loading Animation */
        .loading {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                radial-gradient(ellipse 80% 60% at 50% 30%, rgba(245, 225, 216, 0.95) 0%, transparent 60%),
                rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(4px);
            -webkit-backdrop-filter: blur(4px);
            align-items: center;
            justify-content: center;
            z-index: 250;
            flex-direction: column;
            gap: 1rem;
        }
        
        .loading.active {
            display: flex;
        }
        
        .loading-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 1rem;
        }
        
        .loading-text {
            font-size: 0.875rem;
            color: var(--md-primary);
            font-style: italic;
            animation: loading-pulse 1.5s ease-in-out infinite;
        }
        
        @keyframes loading-pulse {
            0%, 100% { opacity: 0.6; }
            50% { opacity: 1; }
        }
        
        .crochet-loader {
            width: 80px;
            height: 80px;
            position: relative;
        }
        
        .crochet-loader::before,
        .crochet-loader::after {
            content: '';
            position: absolute;
            border-radius: 50%;
            border: 4px solid transparent;
            animation: crochet-spin 1.5s ease-in-out infinite;
        }
        
        .crochet-loader::before {
            width: 100%;
            height: 100%;
            border-top-color: var(--md-primary);
            border-right-color: var(--md-primary);
        }
        
        .crochet-loader::after {
            width: 60%;
            height: 60%;
            top: 20%;
            left: 20%;
            border-bottom-color: var(--md-secondary);
            border-left-color: var(--md-secondary);
            animation-delay: 0.2s;
            animation-direction: reverse;
        }
        
        @keyframes crochet-spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .nav-rail {
                width: 100%;
                height: auto;
                position: fixed;
                bottom: 0;
                top: auto;
                flex-direction: row;
                justify-content: space-around;
                padding: 8px 0;
                border-right: none;
                border-top: 1px solid var(--md-outline-variant);
            }
            
            .nav-rail-logo {
                display: none;
            }
            
            .nav-item {
                margin: 0;
                padding: 8px 16px;
            }
            
            .nav-item span {
                display: none;
            }
            
            .main-content {
                margin-left: 0;
                margin-bottom: 80px;
                padding: 16px;
            }
            
            .data-table {
                overflow-x: auto;
            }
        }
        
        /* Hidden */
        .hidden {
            display: none !important;
        }
        
        /* View Toggle */
        .view-toggle {
            display: flex;
            gap: 4px;
            background: var(--md-surface-container);
            border-radius: var(--md-radius-lg);
            padding: 4px;
            margin-right: 12px;
        }
        
        .view-toggle-btn {
            background: transparent;
            color: var(--md-on-surface-variant);
            border-radius: var(--md-radius-md);
            padding: 8px;
            min-width: 40px;
            height: 40px;
        }
        
        .view-toggle-btn:hover {
            background: var(--md-surface-container-high);
        }
        
        .view-toggle-btn.active {
            background: var(--md-primary);
            color: var(--md-on-primary);
        }
        
        /* Stock Cards Grid */
        #stock-cards {
            display: grid;
            gap: 16px;
        }
        
        /* Settings Grid */
        .settings-grid {
            display: grid;
            gap: 24px;
            grid-template-columns: 1fr;
        }
        
        @media (min-width: 768px) {
            .settings-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        
        .settings-card {
            background: var(--md-surface-container-lowest);
            border-radius: var(--md-radius-lg);
            box-shadow: var(--md-elevation-1);
            overflow: hidden;
        }
        
        .settings-card-header {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 20px 24px;
            background: var(--md-primary-container);
            color: var(--md-on-primary-container);
        }
        
        .settings-card-header .material-icons {
            font-size: 24px;
        }
        
        .settings-card-header h2 {
            font-size: 1.125rem;
            font-weight: 500;
            margin: 0;
        }
        
        .settings-card-body {
            padding: 24px;
        }
        
        .account-info {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }
        
        .info-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid var(--md-outline-variant);
        }
        
        .info-row:last-child {
            border-bottom: none;
        }
        
        .info-label {
            font-weight: 500;
            color: var(--md-on-surface-variant);
        }
        
        .info-value {
            color: var(--md-on-surface);
        }
        
        /* Role Badges */
        .badge-dev_superior {
            background: linear-gradient(135deg, var(--color-dev-purple) 0%, var(--color-dev-purple-dark) 100%);
            color: white;
        }
        
        .badge-admin {
            background: var(--md-primary);
            color: var(--md-on-primary);
        }
        
        .badge-user {
            background: var(--md-secondary-container);
            color: var(--md-on-secondary-container);
        }
        
        /* User Table Actions */
        .user-actions {
            display: flex;
            gap: 8px;
        }
        
        .role-badge {
            padding: 4px 12px;
            border-radius: var(--md-radius-xl);
            font-size: 0.75rem;
            font-weight: 500;
            text-transform: capitalize;
        }
        
        /* Top Bar User Info */
        .user-info {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 8px 16px;
            background: var(--md-surface-container);
            border-radius: var(--md-radius-xl);
        }
        
        .user-info-name {
            font-weight: 500;
            font-size: 0.875rem;
        }
        
        .user-info-role {
            font-size: 0.75rem;
            color: var(--md-on-surface-variant);
            text-transform: capitalize;
        }
        
        /* Profile Page Improvements */
        .profile-header {
            background: linear-gradient(135deg, var(--md-primary-container) 0%, var(--md-secondary-container) 100%);
            border-radius: var(--md-radius-xl);
            padding: 32px;
            margin-bottom: 24px;
            display: flex;
            align-items: center;
            gap: 24px;
            box-shadow: var(--md-elevation-2);
            position: relative;
            overflow: hidden;
        }
        
        .profile-header::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 100%;
            height: 200%;
            background: radial-gradient(circle, rgba(255, 255, 255, 0.1) 0%, transparent 60%);
            pointer-events: none;
        }
        
        .profile-header::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--color-dusk-nude), var(--color-dusty-rose), var(--color-twilight-nude));
        }
        
        .profile-avatar {
            width: 96px;
            height: 96px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--md-primary) 0%, var(--md-tertiary) 100%);
            color: var(--md-on-primary);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5rem;
            font-weight: 500;
            text-transform: uppercase;
            box-shadow: var(--md-elevation-2);
            flex-shrink: 0;
            position: relative;
            z-index: 1;
            border: 4px solid rgba(255, 255, 255, 0.5);
        }
        
        .profile-details {
            flex: 1;
        }
        
        .profile-name {
            font-size: 1.75rem;
            font-weight: 500;
            color: var(--md-on-primary-container);
            margin-bottom: 4px;
        }
        
        .profile-username {
            font-size: 1rem;
            color: var(--md-on-surface-variant);
            margin-bottom: 8px;
        }
        
        .profile-role-badge {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 6px 16px;
            border-radius: var(--md-radius-xl);
            font-size: 0.875rem;
            font-weight: 500;
            text-transform: capitalize;
        }
        
        .profile-role-badge .material-icons {
            font-size: 18px;
        }
        
        .profile-role-badge.badge-dev_superior {
            background: linear-gradient(135deg, var(--color-dev-purple) 0%, var(--color-dev-purple-dark) 100%);
            color: white;
        }
        
        .profile-role-badge.badge-admin {
            background: var(--md-primary);
            color: var(--md-on-primary);
        }
        
        .profile-role-badge.badge-user {
            background: var(--md-secondary-container);
            color: var(--md-on-secondary-container);
        }
        
        .settings-grid-improved {
            display: grid;
            gap: 24px;
            grid-template-columns: 1fr;
        }
        
        @media (min-width: 768px) {
            .settings-grid-improved {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        
        @media (min-width: 1024px) {
            .settings-grid-improved {
                grid-template-columns: repeat(3, 1fr);
            }
        }
        
        .settings-card-improved {
            background: var(--md-surface-container-lowest);
            border-radius: var(--md-radius-lg);
            box-shadow: var(--md-elevation-1);
            overflow: hidden;
            transition: box-shadow var(--md-transition-normal), transform var(--md-transition-normal);
        }
        
        .settings-card-improved:hover {
            box-shadow: var(--md-elevation-2);
            transform: translateY(-2px);
        }
        
        .settings-card-icon-header {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 24px;
            background: linear-gradient(135deg, var(--md-surface-container) 0%, var(--md-surface-container-high) 100%);
            position: relative;
            overflow: hidden;
        }
        
        .settings-card-icon-header::before {
            content: '';
            position: absolute;
            inset: 0;
            background: radial-gradient(circle at center, rgba(176, 141, 124, 0.1) 0%, transparent 70%);
        }
        
        .settings-card-icon-header .material-icons {
            font-size: 48px;
            color: var(--md-primary);
            position: relative;
            z-index: 1;
            filter: drop-shadow(0 2px 4px rgba(176, 141, 124, 0.2));
        }
        
        .settings-card-content {
            padding: 20px 24px 24px;
        }
        
        .settings-card-title {
            font-size: 1.125rem;
            font-weight: 500;
            color: var(--md-on-surface);
            margin-bottom: 4px;
            text-align: center;
        }
        
        .settings-card-subtitle {
            font-size: 0.875rem;
            color: var(--md-on-surface-variant);
            text-align: center;
            margin-bottom: 16px;
        }
        
        .info-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .info-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            background: var(--md-surface-container);
            border-radius: var(--md-radius-md);
        }
        
        .info-item-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--md-primary-container);
            color: var(--md-on-primary-container);
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }
        
        .info-item-icon .material-icons {
            font-size: 20px;
        }
        
        .info-item-content {
            flex: 1;
            min-width: 0;
        }
        
        .info-item-label {
            font-size: 0.75rem;
            color: var(--md-on-surface-variant);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 2px;
        }
        
        .info-item-value {
            font-size: 0.9375rem;
            font-weight: 500;
            color: var(--md-on-surface);
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        
        .password-form-improved {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }
        
        .password-form-improved .md-field {
            margin-bottom: 0;
        }
        
        .session-info {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .session-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            background: var(--md-surface-container);
            border-radius: var(--md-radius-md);
        }
        
        .session-item-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--md-success-container);
            color: var(--md-success);
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }
        
        .session-item-icon .material-icons {
            font-size: 20px;
        }
        
        .session-item-content {
            flex: 1;
        }
        
        .session-item-label {
            font-size: 0.75rem;
            color: var(--md-on-surface-variant);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 2px;
        }
        
        .session-item-value {
            font-size: 0.9375rem;
            font-weight: 500;
            color: var(--md-on-surface);
        }
        
        .quick-actions {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .quick-action-btn {
            display: flex;
            align-items: center;
            gap: 12px;
            width: 100%;
            padding: 12px 16px;
            border: 1px solid var(--md-outline-variant);
            border-radius: var(--md-radius-md);
            background: transparent;
            color: var(--md-on-surface);
            font-size: 0.875rem;
            font-weight: 500;
            cursor: pointer;
            transition: all var(--md-transition-normal);
            text-decoration: none;
            position: relative;
            overflow: hidden;
        }
        
        .quick-action-btn::before {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(135deg, transparent 0%, rgba(176, 141, 124, 0.05) 100%);
            opacity: 0;
            transition: opacity var(--md-transition-normal);
        }
        
        .quick-action-btn:hover {
            background: var(--md-surface-container);
            border-color: var(--md-primary);
            transform: translateX(4px);
        }
        
        .quick-action-btn:hover::before {
            opacity: 1;
        }
        
        .quick-action-btn .material-icons {
            color: var(--md-primary);
            transition: transform var(--md-transition-normal);
        }
        
        .quick-action-btn:hover .material-icons {
            transform: scale(1.15);
        }
        
        /* Mobile adjustments for profile header */
        @media (max-width: 600px) {
            .profile-header {
                flex-direction: column;
                text-align: center;
                padding: 24px;
            }
            
            .profile-avatar {
                width: 80px;
                height: 80px;
                font-size: 2rem;
            }
            
            .profile-name {
                font-size: 1.5rem;
            }
        }
    </style>
</head>
<body>
    <!-- SVG Symbol Definitions (hidden) - Matching frontend -->
    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
        <!-- Palm tree F icon for brand text (uses currentColor for flexibility) -->
        <symbol id="palm-f-icon" viewBox="0 0 24 40">
            <path d="M12 40 Q10 32 11 24 Q12 16 13 10" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" fill="none"/>
            <path d="M13 10 Q8 6 3 8" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" fill="none"/>
            <path d="M13 10 Q8 3 5 1" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" fill="none"/>
            <path d="M13 10 Q15 3 18 1" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" fill="none"/>
            <path d="M13 10 Q18 5 22 6" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" fill="none"/>
            <path d="M13 10 Q20 8 23 10" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" fill="none"/>
        </symbol>
    </svg>

    <!-- Premium Loading Screen - Matching frontend -->
    <div id="page-loader" class="page-loader">
        <div class="loader-content">
            <div class="loader-logo">
                <svg viewBox="0 0 48 48" class="crochet-logo-svg" xmlns="http://www.w3.org/2000/svg">
                    <defs>
                        <linearGradient id="loader-yarn-1" x1="0%" y1="0%" x2="100%" y2="100%">
                            <stop offset="0%" style="stop-color:#FFE4B5;stop-opacity:1" />
                            <stop offset="100%" style="stop-color:#D4A59A;stop-opacity:1" />
                        </linearGradient>
                        <linearGradient id="loader-yarn-2" x1="100%" y1="0%" x2="0%" y2="100%">
                            <stop offset="0%" style="stop-color:#E2BFA5;stop-opacity:1" />
                            <stop offset="100%" style="stop-color:#B08D7C;stop-opacity:1" />
                        </linearGradient>
                    </defs>
                    <ellipse cx="16" cy="24" rx="10" ry="14" fill="none" stroke="url(#loader-yarn-1)" stroke-width="3" stroke-linecap="round"/>
                    <ellipse cx="32" cy="24" rx="10" ry="14" fill="none" stroke="url(#loader-yarn-2)" stroke-width="3" stroke-linecap="round"/>
                    <path d="M22 14 Q24 24 22 34" fill="none" stroke="url(#loader-yarn-1)" stroke-width="2" stroke-linecap="round" opacity="0.8"/>
                    <path d="M26 14 Q24 24 26 34" fill="none" stroke="url(#loader-yarn-2)" stroke-width="2" stroke-linecap="round" opacity="0.8"/>
                    <circle cx="24" cy="24" r="4" fill="none" stroke="#FFE4B5" stroke-width="2"/>
                    <circle cx="10" cy="24" r="1.5" fill="#FFE4B5" opacity="0.7"/>
                    <circle cx="38" cy="24" r="1.5" fill="#FFE4B5" opacity="0.7"/>
                </svg>
            </div>
            <div class="loader-brand">
                <span class="loader-brand-main">Menzah</span><span class="loader-brand-accent">_<svg class="palm-f-icon loader-palm-f" aria-hidden="true"><use href="#palm-f-icon"/></svg>its</span>
            </div>
            <div class="loader-spinner">
                <div class="spinner-circle"></div>
                <div class="spinner-circle spinner-circle-2"></div>
                <div class="spinner-circle spinner-circle-3"></div>
            </div>
            <p class="loader-text">Loading admin panel...</p>
        </div>
    </div>

    <!-- Login Screen -->
    <div id="login-screen" class="login-screen">
        <div class="login-card">
            <div class="login-logo">
                <div class="login-logo-icon">
                    <svg viewBox="0 0 48 48" class="crochet-logo-svg" xmlns="http://www.w3.org/2000/svg">
                        <defs>
                            <linearGradient id="login-yarn-1" x1="0%" y1="0%" x2="100%" y2="100%">
                                <stop offset="0%" style="stop-color:#FFE4B5;stop-opacity:1" />
                                <stop offset="100%" style="stop-color:#D4A59A;stop-opacity:1" />
                            </linearGradient>
                            <linearGradient id="login-yarn-2" x1="100%" y1="0%" x2="0%" y2="100%">
                                <stop offset="0%" style="stop-color:#E2BFA5;stop-opacity:1" />
                                <stop offset="100%" style="stop-color:#B08D7C;stop-opacity:1" />
                            </linearGradient>
                        </defs>
                        <ellipse cx="16" cy="24" rx="10" ry="14" fill="none" stroke="url(#login-yarn-1)" stroke-width="3" stroke-linecap="round"/>
                        <ellipse cx="32" cy="24" rx="10" ry="14" fill="none" stroke="url(#login-yarn-2)" stroke-width="3" stroke-linecap="round"/>
                        <path d="M22 14 Q24 24 22 34" fill="none" stroke="url(#login-yarn-1)" stroke-width="2" stroke-linecap="round" opacity="0.8"/>
                        <path d="M26 14 Q24 24 26 34" fill="none" stroke="url(#login-yarn-2)" stroke-width="2" stroke-linecap="round" opacity="0.8"/>
                        <circle cx="24" cy="24" r="4" fill="none" stroke="#FFE4B5" stroke-width="2"/>
                        <circle cx="10" cy="24" r="1.5" fill="#FFE4B5" opacity="0.7"/>
                        <circle cx="38" cy="24" r="1.5" fill="#FFE4B5" opacity="0.7"/>
                    </svg>
                </div>
                <div class="login-brand">
                    <span class="login-brand-main">Menzah</span><span class="login-brand-accent">_<svg class="palm-f-icon login-palm-f" aria-hidden="true"><use href="#palm-f-icon"/></svg>its</span>
                </div>
                <p>Admin Stock Management</p>
            </div>
            
            <form id="login-form">
                <div class="md-field">
                    <input type="text" id="admin-username" placeholder=" " required autocomplete="username">
                    <label for="admin-username">Username</label>
                </div>
                
                <div class="md-field">
                    <input type="password" id="admin-password" placeholder=" " required autocomplete="current-password">
                    <label for="admin-password">Password</label>
                </div>
                
                <button type="submit" class="md-btn md-btn-primary" style="width: 100%;">
                    <span class="material-icons">login</span>
                    Sign In
                </button>
            </form>
            
            <p style="text-align: center; margin-top: 24px; color: var(--md-on-surface-variant); font-size: 0.875rem;">
                <a href="/" style="color: var(--md-primary); text-decoration: none;"> Back to Store</a>
            </p>
        </div>
    </div>
    
    <!-- App Layout -->
    <div id="app-layout" class="app-layout">
        <!-- Navigation Rail -->
        <nav class="nav-rail">
            <div class="nav-rail-logo">
                <svg viewBox="0 0 48 48" class="crochet-logo-svg nav-crochet-svg" xmlns="http://www.w3.org/2000/svg">
                    <defs>
                        <linearGradient id="nav-yarn-1" x1="0%" y1="0%" x2="100%" y2="100%">
                            <stop offset="0%" style="stop-color:#FFE4B5;stop-opacity:1" />
                            <stop offset="100%" style="stop-color:#D4A59A;stop-opacity:1" />
                        </linearGradient>
                        <linearGradient id="nav-yarn-2" x1="100%" y1="0%" x2="0%" y2="100%">
                            <stop offset="0%" style="stop-color:#E2BFA5;stop-opacity:1" />
                            <stop offset="100%" style="stop-color:#B08D7C;stop-opacity:1" />
                        </linearGradient>
                    </defs>
                    <ellipse cx="16" cy="24" rx="10" ry="14" fill="none" stroke="url(#nav-yarn-1)" stroke-width="3" stroke-linecap="round"/>
                    <ellipse cx="32" cy="24" rx="10" ry="14" fill="none" stroke="url(#nav-yarn-2)" stroke-width="3" stroke-linecap="round"/>
                    <path d="M22 14 Q24 24 22 34" fill="none" stroke="url(#nav-yarn-1)" stroke-width="2" stroke-linecap="round" opacity="0.8"/>
                    <path d="M26 14 Q24 24 26 34" fill="none" stroke="url(#nav-yarn-2)" stroke-width="2" stroke-linecap="round" opacity="0.8"/>
                    <circle cx="24" cy="24" r="4" fill="none" stroke="#FFE4B5" stroke-width="2"/>
                    <circle cx="10" cy="24" r="1.5" fill="#FFE4B5" opacity="0.7"/>
                    <circle cx="38" cy="24" r="1.5" fill="#FFE4B5" opacity="0.7"/>
                </svg>
            </div>
            
            <button class="nav-item active" data-view="dashboard">
                <span class="material-icons">space_dashboard</span>
                <span>Dashboard</span>
            </button>
            
            <button class="nav-item" data-view="products">
                <span class="material-icons">checkroom</span>
                <span>Products</span>
            </button>
            
            <button class="nav-item" data-view="users" id="users-nav">
                <span class="material-icons">manage_accounts</span>
                <span>Users</span>
            </button>
            
            <button class="nav-item" data-view="settings">
                <span class="material-icons">tune</span>
                <span>Settings</span>
            </button>
            
            <button class="nav-item" onclick="logout()" style="margin-top: auto;">
                <span class="material-icons">logout</span>
                <span>Logout</span>
            </button>
        </nav>
        
        <!-- Main Content -->
        <main class="main-content">
            <!-- Dashboard View -->
            <section id="dashboard-view" class="view active">
                <div class="top-bar">
                    <h1><span class="material-icons">space_dashboard</span>Dashboard</h1>
                    <div class="top-bar-actions">
                        <button class="md-btn md-btn-text" onclick="refreshData()">
                            <span class="material-icons">sync</span>
                            Refresh
                        </button>
                    </div>
                </div>
                
                <div class="stats-grid" id="stats-grid">
                    <!-- Stats will be loaded here -->
                </div>
                
                <div class="data-table">
                    <div class="data-table-header">
                        <h2><span class="material-icons">warning_amber</span>Low Stock Alerts</h2>
                    </div>
                    <div id="low-stock-table">
                        <!-- Low stock items will be loaded here -->
                    </div>
                </div>
            </section>
            
            <!-- Products View -->
            <section id="products-view" class="view hidden">
                <div class="top-bar">
                    <h1><span class="material-icons">checkroom</span>Products</h1>
                    <div class="top-bar-actions">
                        <div class="view-toggle">
                            <button class="md-btn md-btn-icon view-toggle-btn active" id="list-view-btn" onclick="setProductView('list')" title="List View">
                                <span class="material-icons">view_list</span>
                            </button>
                            <button class="md-btn md-btn-icon view-toggle-btn" id="card-view-btn" onclick="setProductView('cards')" title="Card View">
                                <span class="material-icons">grid_view</span>
                            </button>
                        </div>
                        <button class="md-btn md-btn-primary" onclick="openAddProductModal()">
                            <span class="material-icons">add_circle</span>
                            Add Product
                        </button>
                    </div>
                </div>
                
                <!-- List View -->
                <div id="products-list-view" class="data-table">
                    <table>
                        <thead>
                            <tr>
                                <th><span class="material-icons">shopping_bag</span> Product</th>
                                <th><span class="material-icons">category</span> Category</th>
                                <th><span class="material-icons">sell</span> Price</th>
                                <th><span class="material-icons">palette</span> Colors</th>
                                <th><span class="material-icons">inventory</span> Stock</th>
                                <th><span class="material-icons">star</span> Badge</th>
                                <th><span class="material-icons">touch_app</span> Actions</th>
                            </tr>
                        </thead>
                        <tbody id="products-table">
                            <!-- Products will be loaded here -->
                        </tbody>
                    </table>
                </div>
                
                <!-- Card View (Stock Cards) -->
                <div id="products-card-view" class="hidden">
                    <div id="stock-cards">
                        <!-- Stock cards will be loaded here -->
                    </div>
                </div>
            </section>
            
            <!-- Users View -->
            <section id="users-view" class="view hidden">
                <div class="top-bar">
                    <h1><span class="material-icons">manage_accounts</span>User Management</h1>
                    <div class="top-bar-actions">
                        <button class="md-btn md-btn-primary" onclick="openAddUserModal()">
                            <span class="material-icons">person_add</span>
                            Add User
                        </button>
                    </div>
                </div>
                
                <div class="data-table">
                    <table>
                        <thead>
                            <tr>
                                <th><span class="material-icons">person</span> Name</th>
                                <th><span class="material-icons">alternate_email</span> Username</th>
                                <th><span class="material-icons">admin_panel_settings</span> Role</th>
                                <th><span class="material-icons">calendar_today</span> Created</th>
                                <th><span class="material-icons">touch_app</span> Actions</th>
                            </tr>
                        </thead>
                        <tbody id="users-table">
                            <!-- Users will be loaded here -->
                        </tbody>
                    </table>
                </div>
            </section>
            
            <!-- Settings View -->
            <section id="settings-view" class="view hidden">
                <div class="top-bar">
                    <h1><span class="material-icons">tune</span>Settings</h1>
                </div>
                
                <!-- Profile Header -->
                <div class="profile-header">
                    <div id="profile-avatar" class="profile-avatar">-</div>
                    <div class="profile-details">
                        <div id="profile-name" class="profile-name">-</div>
                        <div id="profile-username" class="profile-username">@-</div>
                        <span id="profile-role-badge" class="profile-role-badge badge-user">
                            <span class="material-icons">person</span>
                            <span id="profile-role-text">User</span>
                        </span>
                    </div>
                </div>
                
                <div class="settings-grid-improved">
                    <!-- Account Information Card -->
                    <div class="settings-card-improved">
                        <div class="settings-card-icon-header">
                            <span class="material-icons">badge</span>
                        </div>
                        <div class="settings-card-content">
                            <h3 class="settings-card-title">Account Details</h3>
                            <p class="settings-card-subtitle">Your profile information</p>
                            <div class="info-list">
                                <div class="info-item">
                                    <div class="info-item-icon">
                                        <span class="material-icons">person</span>
                                    </div>
                                    <div class="info-item-content">
                                        <div class="info-item-label">Full Name</div>
                                        <div id="account-name" class="info-item-value">-</div>
                                    </div>
                                </div>
                                <div class="info-item">
                                    <div class="info-item-icon">
                                        <span class="material-icons">alternate_email</span>
                                    </div>
                                    <div class="info-item-content">
                                        <div class="info-item-label">Username</div>
                                        <div id="account-username" class="info-item-value">-</div>
                                    </div>
                                </div>
                                <div class="info-item">
                                    <div class="info-item-icon">
                                        <span class="material-icons">shield</span>
                                    </div>
                                    <div class="info-item-content">
                                        <div class="info-item-label">Access Level</div>
                                        <div id="account-role" class="info-item-value">-</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Session Info Card -->
                    <div class="settings-card-improved">
                        <div class="settings-card-icon-header">
                            <span class="material-icons">security</span>
                        </div>
                        <div class="settings-card-content">
                            <h3 class="settings-card-title">Session Info</h3>
                            <p class="settings-card-subtitle">Current login session</p>
                            <div class="session-info">
                                <div class="session-item">
                                    <div class="session-item-icon">
                                        <span class="material-icons">check_circle</span>
                                    </div>
                                    <div class="session-item-content">
                                        <div class="session-item-label">Status</div>
                                        <div class="session-item-value">Active Session</div>
                                    </div>
                                </div>
                                <div class="session-item">
                                    <div class="session-item-icon" style="background: var(--md-tertiary-container); color: var(--md-tertiary);">
                                        <span class="material-icons">schedule</span>
                                    </div>
                                    <div class="session-item-content">
                                        <div class="session-item-label">Session Duration</div>
                                        <div id="session-duration" class="session-item-value">24 hours</div>
                                    </div>
                                </div>
                                <div class="session-item">
                                    <div class="session-item-icon" style="background: var(--md-primary-container); color: var(--md-primary);">
                                        <span class="material-icons">devices</span>
                                    </div>
                                    <div class="session-item-content">
                                        <div class="session-item-label">Device</div>
                                        <div id="session-device" class="session-item-value">Current Browser</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Quick Actions Card -->
                    <div class="settings-card-improved">
                        <div class="settings-card-icon-header">
                            <span class="material-icons">flash_on</span>
                        </div>
                        <div class="settings-card-content">
                            <h3 class="settings-card-title">Quick Actions</h3>
                            <p class="settings-card-subtitle">Frequently used actions</p>
                            <div class="quick-actions">
                                <a href="/" class="quick-action-btn">
                                    <span class="material-icons">storefront</span>
                                    View Storefront
                                </a>
                                <button class="quick-action-btn" onclick="switchView('dashboard')">
                                    <span class="material-icons">dashboard</span>
                                    Go to Dashboard
                                </button>
                                <button class="quick-action-btn" onclick="switchView('products')">
                                    <span class="material-icons">inventory_2</span>
                                    Manage Products
                                </button>
                                <button class="quick-action-btn" onclick="logout()">
                                    <span class="material-icons">logout</span>
                                    Sign Out
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Password Change Section (Full Width) -->
                <div class="settings-card" style="margin-top: 24px;">
                    <div class="settings-card-header">
                        <span class="material-icons">lock</span>
                        <h2>Change Password</h2>
                    </div>
                    <div class="settings-card-body">
                        <form id="change-password-form" class="password-form-improved" style="max-width: 400px;">
                            <div class="md-field">
                                <input type="password" id="current-password" placeholder=" " required autocomplete="current-password">
                                <label for="current-password">Current Password</label>
                            </div>
                            <div class="md-field">
                                <input type="password" id="new-password" placeholder=" " required minlength="4" autocomplete="new-password">
                                <label for="new-password">New Password</label>
                            </div>
                            <div class="md-field">
                                <input type="password" id="confirm-password" placeholder=" " required minlength="4" autocomplete="off">
                                <label for="confirm-password">Confirm New Password</label>
                            </div>
                            <button type="submit" class="md-btn md-btn-primary">
                                <span class="material-icons">save</span>
                                Update Password
                            </button>
                        </form>
                    </div>
                </div>
            </section>
        </main>
    </div>
    
    <!-- Add/Edit Product Modal -->
    <div id="product-modal" class="modal-overlay">
        <div class="modal">
            <div class="modal-header">
                <h2 id="modal-title"><span class="material-icons">add_shopping_cart</span> Add Product</h2>
                <button class="md-btn md-btn-icon md-btn-text" onclick="closeProductModal()">
                    <span class="material-icons">close</span>
                </button>
            </div>
            <form id="product-form">
                <div class="modal-body">
                    <input type="hidden" id="product-id">
                    
                    <div class="form-row">
                        <div class="md-field">
                            <input type="text" id="product-name" placeholder=" " required>
                            <label for="product-name">Product Name</label>
                        </div>
                        
                        <div class="md-field">
                            <select id="product-category" required>
                                <option value="">Select Category</option>
                                <option value="dresses">Dresses</option>
                                <option value="tops">Tops</option>
                                <option value="skirts">Skirts</option>
                                <option value="sets">Sets</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="md-field">
                            <input type="number" id="product-price" placeholder=" " required min="0">
                            <label for="product-price">Price (KES)</label>
                        </div>
                        
                        <div class="md-field">
                            <select id="product-badge">
                                <option value="">No Badge</option>
                                <option value="bestseller">Bestseller</option>
                                <option value="new">New</option>
                                <option value="limited">Limited</option>
                                <option value="featured">Featured</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="md-field">
                        <input type="text" id="product-sizes" placeholder=" " value="S, M, L, XL">
                        <label for="product-sizes">Sizes (comma-separated, e.g., XS, S, M, L, XL)</label>
                    </div>
                    
                    <div class="md-field">
                        <textarea id="product-description" rows="3" placeholder=" " required></textarea>
                        <label for="product-description" style="top: 16px; transform: none;">Description</label>
                    </div>
                    
                    <div class="stock-editor">
                        <h3>Colors & Stock Per Size</h3>
                        <div id="colors-list" class="color-stock-list">
                            <!-- Color items will be added here -->
                        </div>
                        <button type="button" class="md-btn md-btn-text" onclick="addColorField()" style="margin-top: 12px;">
                            <span class="material-icons">add_circle</span>
                            Add Color
                        </button>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="md-btn md-btn-text" onclick="closeProductModal()"><span class="material-icons">close</span> Cancel</button>
                    <button type="submit" class="md-btn md-btn-primary"><span class="material-icons">save</span> Save Product</button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- Edit Stock Modal -->
    <div id="stock-modal" class="modal-overlay">
        <div class="modal">
            <div class="modal-header">
                <h2 id="stock-modal-title"><span class="material-icons">inventory_2</span> Edit Stock</h2>
                <button class="md-btn md-btn-icon md-btn-text" onclick="closeStockModal()">
                    <span class="material-icons">close</span>
                </button>
            </div>
            <form id="stock-form">
                <div class="modal-body">
                    <input type="hidden" id="stock-product-id">
                    <div id="stock-colors-list" class="color-stock-list">
                        <!-- Stock items will be loaded here -->
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="md-btn md-btn-text" onclick="closeStockModal()"><span class="material-icons">close</span> Cancel</button>
                    <button type="submit" class="md-btn md-btn-primary"><span class="material-icons">save</span> Update Stock</button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- Add/Edit User Modal -->
    <div id="user-modal" class="modal-overlay">
        <div class="modal">
            <div class="modal-header">
                <h2 id="user-modal-title"><span class="material-icons">person_add</span> Add User</h2>
                <button class="md-btn md-btn-icon md-btn-text" onclick="closeUserModal()">
                    <span class="material-icons">close</span>
                </button>
            </div>
            <form id="user-form">
                <div class="modal-body">
                    <input type="hidden" id="user-id">
                    
                    <div class="md-field">
                        <input type="text" id="user-name" placeholder=" " required>
                        <label for="user-name">Full Name</label>
                    </div>
                    
                    <div class="md-field">
                        <input type="text" id="user-username" placeholder=" " required autocomplete="off">
                        <label for="user-username">Username</label>
                    </div>
                    
                    <div class="md-field">
                        <input type="password" id="user-password" placeholder=" " autocomplete="new-password">
                        <label for="user-password">Password</label>
                        <small id="password-hint" style="color: var(--md-on-surface-variant); font-size: 0.75rem;">Required for new users. Leave blank to keep existing password.</small>
                    </div>
                    
                    <div class="md-field" id="role-field">
                        <select id="user-role">
                            <option value="user">User</option>
                            <option value="admin">Admin</option>
                        </select>
                        <label for="user-role" style="top: 0; font-size: 0.75rem; color: var(--md-primary);">Role</label>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="md-btn md-btn-text" onclick="closeUserModal()"><span class="material-icons">close</span> Cancel</button>
                    <button type="submit" class="md-btn md-btn-primary"><span class="material-icons">save</span> Save User</button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- Loading Overlay -->
    <div id="loading" class="loading">
        <div class="loading-content">
            <div class="crochet-loader"></div>
            <p class="loading-text">Processing...</p>
        </div>
    </div>
    
    <!-- Snackbar -->
    <div id="snackbar" class="snackbar"></div>
    
    <script>
        // State
        let token = localStorage.getItem('menzah_admin_token');
        let currentUser = JSON.parse(localStorage.getItem('menzah_admin_user') || 'null');
        let collections = [];
        let users = [];
        
        // DOM Elements
        const loginScreen = document.getElementById('login-screen');
        const appLayout = document.getElementById('app-layout');
        const loginForm = document.getElementById('login-form');
        const loading = document.getElementById('loading');
        const snackbar = document.getElementById('snackbar');
        
        // Initialize
        function init() {
            if (token && currentUser) {
                showApp();
                loadDashboard();
                updateUserDisplay();
            }
            
            // Navigation
            document.querySelectorAll('.nav-item[data-view]').forEach(item => {
                item.addEventListener('click', () => switchView(item.dataset.view));
            });
            
            // Forms
            loginForm.addEventListener('submit', handleLogin);
            document.getElementById('product-form').addEventListener('submit', handleProductSubmit);
            document.getElementById('stock-form').addEventListener('submit', handleStockSubmit);
            document.getElementById('user-form').addEventListener('submit', handleUserSubmit);
            document.getElementById('change-password-form').addEventListener('submit', handleChangePassword);
        }
        
        // Auth
        async function handleLogin(e) {
            e.preventDefault();
            showLoading('Signing in...');
            
            try {
                const username = document.getElementById('admin-username').value;
                const password = document.getElementById('admin-password').value;
                const response = await fetch('/api/admin/login', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ username, password })
                });
                
                if (response.ok) {
                    const data = await response.json();
                    token = data.token;
                    currentUser = data.user;
                    localStorage.setItem('menzah_admin_token', token);
                    localStorage.setItem('menzah_admin_user', JSON.stringify(currentUser));
                    showApp();
                    loadDashboard();
                    updateUserDisplay();
                    showSnackbar(`Welcome, ${currentUser.name}!`);
                } else {
                    const error = await response.json();
                    showSnackbar(error.error || 'Invalid username or password');
                }
            } catch {
                showSnackbar('Login failed');
            }
            
            hideLoading();
        }
        
        function logout() {
            token = null;
            currentUser = null;
            localStorage.removeItem('menzah_admin_token');
            localStorage.removeItem('menzah_admin_user');
            loginScreen.style.display = 'flex';
            appLayout.classList.remove('active');
            document.getElementById('admin-username').value = '';
            document.getElementById('admin-password').value = '';
        }
        
        function showApp() {
            loginScreen.style.display = 'none';
            appLayout.classList.add('active');
            
            // Show/hide Users nav based on role
            const usersNav = document.getElementById('users-nav');
            if (currentUser && (currentUser.role === 'admin' || currentUser.role === 'dev_superior')) {
                usersNav.style.display = 'flex';
            } else {
                usersNav.style.display = 'none';
            }
        }
        
        function updateUserDisplay() {
            if (currentUser) {
                // Update profile header - handle edge cases in name parsing
                const nameParts = currentUser.name.split(' ').filter(n => n.trim().length > 0);
                const initials = nameParts.length > 0 
                    ? nameParts.map(n => n[0]).join('').toUpperCase().slice(0, 2) 
                    : currentUser.username.slice(0, 2).toUpperCase();
                document.getElementById('profile-avatar').textContent = initials;
                document.getElementById('profile-name').textContent = currentUser.name;
                document.getElementById('profile-username').textContent = '@' + currentUser.username;
                
                // Update profile role badge
                const profileRoleBadge = document.getElementById('profile-role-badge');
                const profileRoleText = document.getElementById('profile-role-text');
                profileRoleBadge.className = `profile-role-badge badge-${currentUser.role}`;
                profileRoleText.textContent = currentUser.role.replace('_', ' ');
                
                // Update role icon based on role
                const roleIcon = profileRoleBadge.querySelector('.material-icons');
                if (currentUser.role === 'dev_superior') {
                    roleIcon.textContent = 'verified_user';
                } else if (currentUser.role === 'admin') {
                    roleIcon.textContent = 'admin_panel_settings';
                } else {
                    roleIcon.textContent = 'person';
                }
                
                // Update account details section
                document.getElementById('account-name').textContent = currentUser.name;
                document.getElementById('account-username').textContent = currentUser.username;
                document.getElementById('account-role').textContent = currentUser.role.replace('_', ' ');
                
                // Update session info - detect device using touch capability and screen size
                const isTouchDevice = ('ontouchstart' in window) || (navigator.maxTouchPoints > 0);
                const isSmallScreen = window.matchMedia('(max-width: 768px)').matches;
                const deviceInfo = (isTouchDevice && isSmallScreen) ? 'Mobile Device' : 'Desktop Browser';
                document.getElementById('session-device').textContent = deviceInfo;
            }
        }
        
        // Views
        function switchView(viewName) {
            document.querySelectorAll('.view').forEach(v => v.classList.add('hidden'));
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            
            document.getElementById(`${viewName}-view`).classList.remove('hidden');
            document.querySelector(`[data-view="${viewName}"]`).classList.add('active');
            
            if (viewName === 'dashboard') loadDashboard();
            if (viewName === 'products') loadProducts();
            if (viewName === 'users') loadUsers();
            if (viewName === 'settings') loadSettings();
        }
        
        // Product View Toggle (list vs cards)
        let currentProductView = 'list';
        
        function setProductView(view) {
            currentProductView = view;
            
            // Update toggle buttons
            document.getElementById('list-view-btn').classList.toggle('active', view === 'list');
            document.getElementById('card-view-btn').classList.toggle('active', view === 'cards');
            
            // Show/hide views
            document.getElementById('products-list-view').classList.toggle('hidden', view !== 'list');
            document.getElementById('products-card-view').classList.toggle('hidden', view !== 'cards');
            
            // Load data for cards if switching to card view
            if (view === 'cards') {
                loadStockCards();
            }
        }
        
        // Helper function to compute total stock for a color
        function computeColorTotalStock(sizeStock) {
            if (!sizeStock || typeof sizeStock !== 'object') return 0;
            return Object.values(sizeStock).reduce((sum, v) => sum + (parseInt(v) || 0), 0);
        }
        
        // Load Stock Cards (card view for products)
        async function loadStockCards() {
            try {
                document.getElementById('stock-cards').innerHTML = `
                    <div style="display: grid; gap: 16px;">
                        ${collections.map(item => `
                            <div class="data-table" style="padding: 24px;">
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                                    <div>
                                        <h3 style="font-size: 1.125rem; font-weight: 500;">${item.name}</h3>
                                        <p style="color: var(--md-on-surface-variant); font-size: 0.875rem;">Total Stock: ${item.totalStock} | Sizes: ${(item.sizes || []).join(', ')}</p>
                                    </div>
                                    <button class="md-btn md-btn-secondary" onclick="openStockModal('${item.id}')">
                                        <span class="material-icons">edit</span>
                                        Edit Stock
                                    </button>
                                </div>
                                <div class="color-stock-list">
                                    ${item.colors.map(c => {
                                        const colorTotal = computeColorTotalStock(c.sizeStock);
                                        const sizeStockDisplay = Object.entries(c.sizeStock || {})
                                            .map(([size, stock]) => `${size}: ${stock}`)
                                            .join(', ') || 'No stock';
                                        return `
                                            <div class="color-stock-item">
                                                <div class="color-preview" style="background: ${c.hex};"></div>
                                                <div class="color-info">
                                                    <div class="color-name">${c.name}</div>
                                                    <div class="color-hex">${c.hex}</div>
                                                </div>
                                                <div style="flex: 1; text-align: right;">
                                                    <span class="badge ${colorTotal < 3 ? 'badge-low' : 'badge-ok'}">${colorTotal} total</span>
                                                    <div style="font-size: 0.75rem; color: var(--md-on-surface-variant); margin-top: 4px;">${sizeStockDisplay}</div>
                                                </div>
                                            </div>
                                        `;
                                    }).join('')}
                                </div>
                            </div>
                        `).join('')}
                    </div>
                `;
            } catch {
                showSnackbar('Failed to load stock cards');
            }
        }
        
        // API Calls
        async function apiCall(endpoint, options = {}) {
            const defaultHeaders = {
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${token}`
            };
            
            const response = await fetch(endpoint, {
                ...options,
                headers: { ...defaultHeaders, ...options.headers }
            });
            
            if (response.status === 401) {
                logout();
                throw new Error('Unauthorized');
            }
            
            return response.json();
        }
        
        // Dashboard
        async function loadDashboard() {
            showLoading();
            
            try {
                const [inventory, allCollections] = await Promise.all([
                    apiCall('/api/admin/inventory'),
                    apiCall('/api/admin/collections')
                ]);
                
                collections = allCollections;
                
                // Stats
                document.getElementById('stats-grid').innerHTML = `
                    <div class="stat-card">
                        <div class="stat-card-icon primary">
                            <span class="material-icons">inventory_2</span>
                        </div>
                        <h3>Total Products</h3>
                        <div class="value">${inventory.totalProducts}</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-card-icon secondary">
                            <span class="material-icons">shopping_bag</span>
                        </div>
                        <h3>Total Stock</h3>
                        <div class="value">${inventory.totalStock}</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-card-icon tertiary">
                            <span class="material-icons">warning</span>
                        </div>
                        <h3>Low Stock Items</h3>
                        <div class="value">${inventory.lowStock.length}</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-card-icon error">
                            <span class="material-icons">error</span>
                        </div>
                        <h3>Out of Stock</h3>
                        <div class="value">${inventory.outOfStock.length}</div>
                    </div>
                `;
                
                // Low stock table
                const lowStockItems = [...inventory.lowStock, ...inventory.outOfStock];
                if (lowStockItems.length > 0) {
                    document.getElementById('low-stock-table').innerHTML = `
                        <table>
                            <thead>
                                <tr>
                                    <th>Product</th>
                                    <th>Stock</th>
                                    <th>Action</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${lowStockItems.map(item => `
                                    <tr>
                                        <td>${item.name}</td>
                                        <td><span class="badge ${item.totalStock === 0 ? 'badge-limited' : 'badge-new'}">${item.totalStock}</span></td>
                                        <td>
                                            <button class="md-btn md-btn-text" onclick="openStockModal('${item.id}')">
                                                <span class="material-icons">edit</span>
                                                Update Stock
                                            </button>
                                        </td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    `;
                } else {
                    document.getElementById('low-stock-table').innerHTML = `
                        <p style="padding: 24px; text-align: center; color: var(--md-on-surface-variant);">
                            All products are well stocked! 
                        </p>
                    `;
                }
            } catch {
                showSnackbar('Failed to load dashboard');
            }
            
            hideLoading();
        }
        
        // Products
        async function loadProducts() {
            showLoading();
            
            try {
                collections = await apiCall('/api/admin/collections');
                
                document.getElementById('products-table').innerHTML = collections.map(item => `
                    <tr>
                        <td><strong>${item.name}</strong></td>
                        <td style="text-transform: capitalize;">${item.category}</td>
                        <td>${item.priceFormatted}</td>
                        <td>
                            <div class="color-dots">
                                ${item.colors.map(c => {
                                    const colorTotal = computeColorTotalStock(c.sizeStock);
                                    return `<div class="color-dot" style="background: ${c.hex};" title="${c.name}: ${colorTotal} in stock"></div>`;
                                }).join('')}
                            </div>
                        </td>
                        <td>
                            <span class="badge ${item.totalStock < 5 ? 'badge-low' : 'badge-ok'}">${item.totalStock}</span>
                        </td>
                        <td>${item.badge ? `<span class="badge badge-${item.badge}">${item.badge}</span>` : '-'}</td>
                        <td>
                            <button class="md-btn md-btn-icon md-btn-text" onclick="editProduct('${item.id}')" title="Edit">
                                <span class="material-icons">edit</span>
                            </button>
                            <button class="md-btn md-btn-icon md-btn-text" onclick="openStockModal('${item.id}')" title="Update Stock">
                                <span class="material-icons">inventory</span>
                            </button>
                            <button class="md-btn md-btn-icon md-btn-text" onclick="deleteProduct('${item.id}')" title="Delete">
                                <span class="material-icons">delete</span>
                            </button>
                        </td>
                    </tr>
                `).join('');
                
                // Also update card view if it's the current view
                if (currentProductView === 'cards') {
                    loadStockCards();
                }
            } catch {
                showSnackbar('Failed to load products');
            }
            
            hideLoading();
        }
        
        // Product Modal
        function openAddProductModal() {
            document.getElementById('modal-title').innerHTML = '<span class="material-icons">add_shopping_cart</span> Add Product';
            document.getElementById('product-form').reset();
            document.getElementById('product-id').value = '';
            document.getElementById('product-sizes').value = 'S, M, L, XL';
            document.getElementById('colors-list').innerHTML = '';
            addColorField();
            document.getElementById('product-modal').classList.add('active');
        }
        
        function editProduct(id) {
            const product = collections.find(c => c.id === id);
            if (!product) return;
            
            document.getElementById('modal-title').innerHTML = '<span class="material-icons">edit</span> Edit Product';
            document.getElementById('product-id').value = product.id;
            document.getElementById('product-name').value = product.name;
            document.getElementById('product-category').value = product.category;
            document.getElementById('product-price').value = product.price;
            document.getElementById('product-badge').value = product.badge || '';
            document.getElementById('product-description').value = product.description;
            document.getElementById('product-sizes').value = (product.sizes || []).join(', ');
            
            document.getElementById('colors-list').innerHTML = '';
            product.colors.forEach(c => addColorField(c.hex, c.name, c.sizeStock || {}, c.media || []));
            
            document.getElementById('product-modal').classList.add('active');
        }
        
        function closeProductModal() {
            document.getElementById('product-modal').classList.remove('active');
        }
        
        // Helper function to get sizes from the form
        function getProductSizes() {
            const sizesInput = document.getElementById('product-sizes').value;
            return sizesInput.split(',').map(s => s.trim()).filter(s => s);
        }
        
        // Store media data per color
        let colorMediaData = {};
        
        let colorCount = 0;
        function addColorField(hex = '', name = '', sizeStock = {}, media = []) {
            const id = colorCount++;
            const sizes = getProductSizes();
            
            // Initialize media data for this color
            colorMediaData[id] = media || [];
            
            const sizeInputsHTML = sizes.map(size => {
                const stock = sizeStock[size] || 0;
                return `
                    <div class="size-stock-input">
                        <label>${size}</label>
                        <input type="number" value="${stock}" name="color-size-${id}-${size}" min="0" data-size="${size}">
                    </div>
                `;
            }).join('');
            
            // Generate existing media previews
            const mediaPreviewsHTML = (media || []).map((m, idx) => `
                <div class="media-preview-item" data-media-index="${idx}">
                    ${m.type === 'video' 
                        ? `<video src="${m.url}" muted></video><span class="media-type-badge">Video</span>`
                        : `<img src="${m.url}" alt="Product media">`
                    }
                    <button type="button" class="remove-media" onclick="removeColorMedia(${id}, ${idx})">
                        <span class="material-icons">close</span>
                    </button>
                </div>
            `).join('');
            
            const html = `
                <div class="color-stock-item" data-color-id="${id}">
                    <input type="color" class="color-preview" value="${hex || '#2A7B9B'}" name="color-hex-${id}">
                    <div class="color-info">
                        <input type="text" placeholder="Color Name" value="${name}" name="color-name-${id}" required style="width: 100%; border: none; font-weight: 500; background: transparent;">
                    </div>
                    <button type="button" class="md-btn md-btn-icon md-btn-text" onclick="removeColorField(${id})">
                        <span class="material-icons">close</span>
                    </button>
                    <div class="size-stock-grid">
                        ${sizeInputsHTML || '<span style="color: var(--md-on-surface-variant); font-size: 0.75rem;">Add sizes above first</span>'}
                    </div>
                    <div class="media-upload-section">
                        <div class="media-upload-header">
                            <span class="material-icons">perm_media</span>
                            <span>Product Media for this Color</span>
                        </div>
                        <div class="media-upload-grid" id="media-grid-${id}">
                            ${mediaPreviewsHTML}
                            <label class="media-upload-btn">
                                <span class="material-icons">add_photo_alternate</span>
                                <span>Add Image</span>
                                <input type="file" accept="image/*" onchange="handleMediaUpload(${id}, this, 'image')">
                            </label>
                            <label class="media-upload-btn">
                                <span class="material-icons">video_call</span>
                                <span>Add Video</span>
                                <input type="file" accept="video/*" onchange="handleMediaUpload(${id}, this, 'video')">
                            </label>
                        </div>
                    </div>
                </div>
            `;
            document.getElementById('colors-list').insertAdjacentHTML('beforeend', html);
        }
        
        // Handle media file upload
        function handleMediaUpload(colorId, input, mediaType) {
            const file = input.files[0];
            if (!file) return;
            
            // Validate file size (max 10MB for images, 50MB for videos)
            const maxSize = mediaType === 'video' ? 50 * 1024 * 1024 : 10 * 1024 * 1024;
            if (file.size > maxSize) {
                showSnackbar(`File too large. Max size: ${mediaType === 'video' ? '50MB' : '10MB'}`);
                input.value = '';
                return;
            }
            
            // Create a local URL for preview
            const reader = new FileReader();
            reader.onload = function(e) {
                const mediaData = {
                    url: e.target.result,
                    type: mediaType,
                    name: file.name,
                    file: file // Keep reference to file for upload
                };
                
                if (!colorMediaData[colorId]) {
                    colorMediaData[colorId] = [];
                }
                colorMediaData[colorId].push(mediaData);
                
                // Update the media grid
                updateMediaGrid(colorId);
            };
            reader.readAsDataURL(file);
            
            // Reset input for future uploads
            input.value = '';
        }
        
        // Update media grid UI
        function updateMediaGrid(colorId) {
            const grid = document.getElementById(`media-grid-${colorId}`);
            if (!grid) return;
            
            const media = colorMediaData[colorId] || [];
            const mediaPreviewsHTML = media.map((m, idx) => `
                <div class="media-preview-item" data-media-index="${idx}">
                    ${m.type === 'video' 
                        ? `<video src="${m.url}" muted></video><span class="media-type-badge">Video</span>`
                        : `<img src="${m.url}" alt="Product media">`
                    }
                    <button type="button" class="remove-media" onclick="removeColorMedia(${colorId}, ${idx})">
                        <span class="material-icons">close</span>
                    </button>
                </div>
            `).join('');
            
            grid.innerHTML = `
                ${mediaPreviewsHTML}
                <label class="media-upload-btn">
                    <span class="material-icons">add_photo_alternate</span>
                    <span>Add Image</span>
                    <input type="file" accept="image/*" onchange="handleMediaUpload(${colorId}, this, 'image')">
                </label>
                <label class="media-upload-btn">
                    <span class="material-icons">video_call</span>
                    <span>Add Video</span>
                    <input type="file" accept="video/*" onchange="handleMediaUpload(${colorId}, this, 'video')">
                </label>
            `;
        }
        
        // Remove media from color
        function removeColorMedia(colorId, mediaIndex) {
            if (colorMediaData[colorId]) {
                colorMediaData[colorId].splice(mediaIndex, 1);
                updateMediaGrid(colorId);
            }
        }
        
        // Update color size inputs when sizes field changes
        document.getElementById('product-sizes').addEventListener('change', function() {
            const colorItems = document.querySelectorAll('#colors-list .color-stock-item');
            colorItems.forEach(item => {
                const colorId = item.dataset.colorId;
                const hexInput = item.querySelector(`[name="color-hex-${colorId}"]`);
                const nameInput = item.querySelector(`[name="color-name-${colorId}"]`);
                const hex = hexInput.value;
                const name = nameInput.value;
                
                // Get existing size stock values
                const existingSizeStock = {};
                item.querySelectorAll('.size-stock-input input').forEach(input => {
                    const size = input.dataset.size;
                    existingSizeStock[size] = parseInt(input.value) || 0;
                });
                
                // Remove and re-add the color field with updated sizes
                item.remove();
                addColorField(hex, name, existingSizeStock);
            });
        });
        
        function removeColorField(id) {
            document.querySelector(`[data-color-id="${id}"]`).remove();
        }
        
        async function handleProductSubmit(e) {
            e.preventDefault();
            showLoading();
            
            const id = document.getElementById('product-id').value;
            const sizes = getProductSizes();
            const colors = [];
            
            document.querySelectorAll('#colors-list .color-stock-item').forEach(item => {
                const colorId = item.dataset.colorId;
                const sizeStock = {};
                
                // Collect size stock values
                item.querySelectorAll('.size-stock-input input').forEach(input => {
                    const size = input.dataset.size;
                    sizeStock[size] = parseInt(input.value) || 0;
                });
                
                // Get media data for this color (filter out local file references)
                const mediaData = (colorMediaData[colorId] || []).map(m => ({
                    id: m.id || undefined,
                    url: m.url,
                    type: m.type
                }));
                
                colors.push({
                    hex: item.querySelector(`[name="color-hex-${colorId}"]`).value,
                    name: item.querySelector(`[name="color-name-${colorId}"]`).value,
                    sizeStock,
                    media: mediaData
                });
            });
            
            const data = {
                name: document.getElementById('product-name').value,
                category: document.getElementById('product-category').value,
                price: document.getElementById('product-price').value,
                badge: document.getElementById('product-badge').value || null,
                description: document.getElementById('product-description').value,
                sizes,
                colors
            };
            
            try {
                if (id) {
                    await apiCall(`/api/admin/collections/${id}`, {
                        method: 'PUT',
                        body: JSON.stringify(data)
                    });
                    showSnackbar('Product updated successfully');
                } else {
                    await apiCall('/api/admin/collections', {
                        method: 'POST',
                        body: JSON.stringify(data)
                    });
                    showSnackbar('Product created successfully');
                }
                
                closeProductModal();
                loadProducts();
            } catch {
                showSnackbar('Failed to save product');
            }
            
            hideLoading();
        }
        
        async function deleteProduct(id) {
            if (!confirm('Are you sure you want to delete this product?')) return;
            
            showLoading();
            
            try {
                await apiCall(`/api/admin/collections/${id}`, { method: 'DELETE' });
                showSnackbar('Product deleted');
                loadProducts();
            } catch {
                showSnackbar('Failed to delete product');
            }
            
            hideLoading();
        }
        
        // Stock Modal
        function openStockModal(id) {
            const product = collections.find(c => c.id === id);
            if (!product) return;
            
            document.getElementById('stock-modal-title').innerHTML = `<span class="material-icons">inventory_2</span> Update Stock - ${product.name}`;
            document.getElementById('stock-product-id').value = id;
            
            const sizes = product.sizes || [];
            
            document.getElementById('stock-colors-list').innerHTML = product.colors.map((c, colorIndex) => {
                const sizeStock = c.sizeStock || {};
                const sizeInputsHTML = sizes.map(size => `
                    <div class="size-stock-input">
                        <label>${size}</label>
                        <input type="number" value="${sizeStock[size] || 0}" data-hex="${c.hex}" data-size="${size}" min="0">
                    </div>
                `).join('');
                
                return `
                    <div class="color-stock-item" data-color-hex="${c.hex}">
                        <div class="color-preview" style="background: ${c.hex};"></div>
                        <div class="color-info">
                            <div class="color-name">${c.name}</div>
                            <div class="color-hex">${c.hex}</div>
                        </div>
                        <div class="size-stock-grid">
                            ${sizeInputsHTML || '<span style="color: var(--md-on-surface-variant); font-size: 0.75rem;">No sizes defined</span>'}
                        </div>
                    </div>
                `;
            }).join('');
            
            document.getElementById('stock-modal').classList.add('active');
        }
        
        function closeStockModal() {
            document.getElementById('stock-modal').classList.remove('active');
        }
        
        async function handleStockSubmit(e) {
            e.preventDefault();
            showLoading();
            
            const id = document.getElementById('stock-product-id').value;
            const colorItems = document.querySelectorAll('#stock-colors-list .color-stock-item');
            
            try {
                for (const item of colorItems) {
                    const colorHex = item.dataset.colorHex;
                    const sizeStock = {};
                    
                    item.querySelectorAll('.size-stock-input input').forEach(input => {
                        const size = input.dataset.size;
                        sizeStock[size] = parseInt(input.value) || 0;
                    });
                    
                    await apiCall(`/api/admin/collections/${id}/stock`, {
                        method: 'PATCH',
                        body: JSON.stringify({
                            colorHex,
                            sizeStock
                        })
                    });
                }
                
                showSnackbar('Stock updated successfully');
                closeStockModal();
                
                // Refresh current view
                const activeView = document.querySelector('.nav-item.active').dataset.view;
                if (activeView === 'dashboard') loadDashboard();
                else if (activeView === 'products') loadProducts();
            } catch {
                showSnackbar('Failed to update stock');
            }
            
            hideLoading();
        }
        
        // ===========================
        // USER MANAGEMENT
        // ===========================
        
        async function loadUsers() {
            showLoading();
            
            try {
                users = await apiCall('/api/admin/users');
                
                document.getElementById('users-table').innerHTML = users.map(user => `
                    <tr>
                        <td><strong>${user.name}</strong></td>
                        <td>${user.username}</td>
                        <td><span class="badge role-badge badge-${user.role}">${user.role.replace('_', ' ')}</span></td>
                        <td>${new Date(user.createdAt).toLocaleDateString()}</td>
                        <td>
                            <div class="user-actions">
                                ${canEditUser(user) ? `
                                    <button class="md-btn md-btn-icon md-btn-text" onclick="editUser('${user.id}')" title="Edit">
                                        <span class="material-icons">edit</span>
                                    </button>
                                ` : ''}
                                ${canDeleteUser(user) ? `
                                    <button class="md-btn md-btn-icon md-btn-text" onclick="deleteUser('${user.id}')" title="Delete">
                                        <span class="material-icons">delete</span>
                                    </button>
                                ` : ''}
                            </div>
                        </td>
                    </tr>
                `).join('');
            } catch (err) {
                showSnackbar('Failed to load users');
            }
            
            hideLoading();
        }
        
        function canEditUser(user) {
            if (!currentUser) return false;
            if (currentUser.role === 'dev_superior') return true;
            if (currentUser.role === 'admin') {
                return user.role !== 'dev_superior' && user.role !== 'admin';
            }
            return user.id === currentUser.id;
        }
        
        function canDeleteUser(user) {
            if (!currentUser) return false;
            if (user.id === currentUser.id) return false;
            if (user.role === 'dev_superior') return false;
            if (currentUser.role === 'dev_superior') return true;
            if (currentUser.role === 'admin' && user.role === 'user') return true;
            return false;
        }
        
        function openAddUserModal() {
            document.getElementById('user-modal-title').innerHTML = '<span class="material-icons">person_add</span> Add User';
            document.getElementById('user-form').reset();
            document.getElementById('user-id').value = '';
            document.getElementById('user-username').readOnly = false;
            document.getElementById('user-password').required = true;
            document.getElementById('password-hint').textContent = 'Required for new users';
            
            // Show role field based on current user's role
            const roleField = document.getElementById('role-field');
            if (currentUser.role === 'dev_superior') {
                roleField.style.display = 'block';
            } else {
                roleField.style.display = 'none';
                document.getElementById('user-role').value = 'user';
            }
            
            document.getElementById('user-modal').classList.add('active');
        }
        
        function editUser(id) {
            const user = users.find(u => u.id === id);
            if (!user) return;
            
            document.getElementById('user-modal-title').innerHTML = '<span class="material-icons">edit</span> Edit User';
            document.getElementById('user-id').value = user.id;
            document.getElementById('user-name').value = user.name;
            document.getElementById('user-username').value = user.username;
            document.getElementById('user-username').readOnly = true;
            document.getElementById('user-password').value = '';
            document.getElementById('user-password').required = false;
            document.getElementById('password-hint').textContent = 'Leave blank to keep existing password';
            document.getElementById('user-role').value = user.role;
            
            // Show role field only for dev_superior
            const roleField = document.getElementById('role-field');
            if (currentUser.role === 'dev_superior') {
                roleField.style.display = 'block';
            } else {
                roleField.style.display = 'none';
            }
            
            document.getElementById('user-modal').classList.add('active');
        }
        
        function closeUserModal() {
            document.getElementById('user-modal').classList.remove('active');
        }
        
        async function handleUserSubmit(e) {
            e.preventDefault();
            showLoading();
            
            const id = document.getElementById('user-id').value;
            const data = {
                name: document.getElementById('user-name').value,
                username: document.getElementById('user-username').value,
                role: document.getElementById('user-role').value
            };
            
            const password = document.getElementById('user-password').value;
            if (password) {
                data.password = password;
            }
            
            try {
                if (id) {
                    await apiCall(`/api/admin/users/${id}`, {
                        method: 'PUT',
                        body: JSON.stringify(data)
                    });
                    showSnackbar('User updated successfully');
                } else {
                    if (!password) {
                        showSnackbar('Password is required for new users');
                        hideLoading();
                        return;
                    }
                    await apiCall('/api/admin/users', {
                        method: 'POST',
                        body: JSON.stringify(data)
                    });
                    showSnackbar('User created successfully');
                }
                
                closeUserModal();
                loadUsers();
            } catch (err) {
                showSnackbar('Failed to save user');
            }
            
            hideLoading();
        }
        
        async function deleteUser(id) {
            if (!confirm('Are you sure you want to delete this user?')) return;
            
            showLoading();
            
            try {
                await apiCall(`/api/admin/users/${id}`, { method: 'DELETE' });
                showSnackbar('User deleted successfully');
                loadUsers();
            } catch {
                showSnackbar('Failed to delete user');
            }
            
            hideLoading();
        }
        
        // ===========================
        // SETTINGS
        // ===========================
        
        function loadSettings() {
            updateUserDisplay();
        }
        
        async function handleChangePassword(e) {
            e.preventDefault();
            
            const currentPassword = document.getElementById('current-password').value;
            const newPassword = document.getElementById('new-password').value;
            const confirmPassword = document.getElementById('confirm-password').value;
            
            if (newPassword !== confirmPassword) {
                showSnackbar('New passwords do not match');
                return;
            }
            
            if (newPassword.length < 4) {
                showSnackbar('Password must be at least 4 characters');
                return;
            }
            
            showLoading();
            
            try {
                const response = await fetch('/api/admin/change-password', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({ currentPassword, newPassword })
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    showSnackbar('Password changed successfully');
                    document.getElementById('change-password-form').reset();
                } else {
                    showSnackbar(data.error || 'Failed to change password');
                }
            } catch {
                showSnackbar('Failed to change password');
            }
            
            hideLoading();
        }
        
        // Utilities
        function refreshData() {
            const activeView = document.querySelector('.nav-item.active').dataset.view;
            switchView(activeView);
        }
        
        function showLoading(message = 'Processing...') {
            const loadingText = loading.querySelector('.loading-text');
            if (loadingText) {
                loadingText.textContent = message;
            }
            loading.classList.add('active');
        }
        
        function hideLoading() {
            loading.classList.remove('active');
        }
        
        function showSnackbar(message) {
            snackbar.textContent = message;
            snackbar.classList.add('active');
            setTimeout(() => snackbar.classList.remove('active'), 3000);
        }
        
        // Hide page loader after content loads
        // Delay timing (800ms) allows the loading animation to be visible
        // before transitioning to the login screen or main app
        const PAGE_LOADER_DELAY_MS = 800;
        
        function hidePageLoader() {
            const pageLoader = document.getElementById('page-loader');
            if (pageLoader) {
                pageLoader.classList.add('hidden');
            }
        }
        
        // Initialize on load
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(hidePageLoader, PAGE_LOADER_DELAY_MS);
        });
        
        init();
    </script>
</body>
</html>
